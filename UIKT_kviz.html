<!doctype html>
<html lang="sl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kviz (nakljuƒçno 20 vpra≈°anj)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #0b1020; color: #e8ecff; }
    .wrap { max-width: 920px; margin: 0 auto; padding: 24px; }
    .card { background: #121a33; border-radius: 14px; padding: 18px 18px; box-shadow: 0 10px 28px rgba(0,0,0,.45); border: 1px solid rgba(255,255,255,.08); }
    h1 { margin: 0 0 10px; font-size: 20px; color:#f2f5ff; }
    .muted { color:#b9c2ee; font-size: 14px; line-height: 1.4; }
    .row { display:flex; gap:12px; flex-wrap: wrap; align-items:center; }
    .spacer { height: 12px; }

    button {
      border: 0; border-radius: 10px; padding: 10px 14px;
      background: #2b59ff; color: #fff; cursor:pointer; font-weight: 700;
      box-shadow: 0 10px 20px rgba(43,89,255,.25);
    }
    button.secondary { background: #1b254a; color:#e8ecff; box-shadow:none; border:1px solid rgba(255,255,255,.10); }
    button.ghost { background: transparent; border: 1px solid rgba(255,255,255,.18); color:#e8ecff; box-shadow:none; }
    button:disabled { opacity:.55; cursor:not-allowed; }

    .pill { display:inline-block; padding: 4px 10px; background:#1b254a; color:#cfe0ff; border-radius: 999px; font-size: 12px; border:1px solid rgba(255,255,255,.10); }
    .qtitle { font-weight: 800; margin: 10px 0 10px; color:#f2f5ff; }
    .opts { display: grid; gap: 10px; }

    label.opt {
      display:flex; gap:10px; align-items:flex-start;
      padding: 10px 12px; border: 1px solid rgba(255,255,255,.12); border-radius: 12px; cursor:pointer;
      background: #0f1730;
    }
    label.opt:hover { background:#111c38; }
    input { accent-color: #2b59ff; }

    .footer {
      display:flex; gap: 10px; justify-content: space-between; align-items:center; flex-wrap:wrap;
      margin-top: 14px;
    }
    .hr { height:1px; background: rgba(255,255,255,.10); margin: 14px 0; }
    .small { font-size: 13px; color:#c6d0ff; line-height:1.45; }
    code.k { background:#0f1730; border:1px solid rgba(255,255,255,.10); padding: 2px 6px; border-radius: 6px; color:#dce4ff; }

    /* ---- result summary ---- */
    .summary-box { padding: 14px; border: 1px solid rgba(255,255,255,.10); border-radius: 12px; background:#0f1730; }
    .summary-title { font-weight: 900; margin-bottom: 6px; color:#f2f5ff; }
    .summary-line { font-size: 14px; color:#e8ecff; }
    .badges { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .badge {
      display:flex; align-items:center; gap:8px;
      padding: 6px 10px; border-radius: 10px; font-size: 13px; font-weight: 800;
      border: 1px solid rgba(255,255,255,.14); background:#121a33;
    }
    .badge.ok { border-color: rgba(34,197,94,.45); }
    .badge.bad { border-color: rgba(239,68,68,.45); }
    .badge.warn { border-color: rgba(245,158,11,.45); }
    .badge.neutral { border-color: rgba(148,163,184,.35); }
    .badge .dot {
      width: 16px; height: 16px; border-radius: 4px; display:inline-grid; place-items:center;
      font-size: 12px; line-height: 1;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
    }

    /* ---- error list rows ---- */
    .error-row {
      display:flex; justify-content:space-between; align-items:center;
      border: 1px solid rgba(255,255,255,.12); border-radius: 12px; padding: 12px;
      margin: 10px 0; background:#0f1730;
    }
    .error-left { font-size: 14px; color:#e8ecff; }
    .error-left b { font-weight: 900; color:#f2f5ff; }
    .error-score { font-weight: 900; font-variant-numeric: tabular-nums; color:#f2f5ff; }

    /* ---- expanded details for wrong questions ---- */
    .error-details { margin-top: 10px; display:grid; gap:8px; }
    .detail-line { font-size: 13px; color:#c6d0ff; }
    .chips { display:flex; flex-wrap:wrap; gap:8px; margin-top:6px; }
    .chip {
      display:inline-flex; align-items:center; gap:6px;
      padding: 5px 8px; border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      font-size: 12px; font-weight: 700;
      color:#dce4ff;
    }
    .chip.ok { border-color: rgba(34,197,94,.45); }
    .chip.bad { border-color: rgba(239,68,68,.45); }
    .chip.miss { border-color: rgba(245,158,11,.45); }

    .optlist { margin: 6px 0 0; padding-left: 18px; color:#c6d0ff; }
    .optlist li { margin: 4px 0; }
    .mark-ok { color: #22c55e; font-weight: 900; }
    .mark-bad { color: #ef4444; font-weight: 900; }
    .mark-miss { color: #f59e0b; font-weight: 900; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="screenStart">
      <h1>Kviz: nakljuƒçno 20 vpra≈°anj</h1>
      <div class="muted">
        Pravila:
        <ul>
          <li>Eno vpra≈°anje naenkrat</li>
          <li>Gumba Nazaj / Naprej</li>
          <li>Preveri ≈°ele na koncu</li>
          <li>Veƒç izbir (checkbox): delne toƒçke + kazen za napaƒçne izbire</li>
          <li>Po oddaji dobi≈° pregled napak</li>
        </ul>
        Toƒçkovanje pri checkbox vpra≈°anjih (na nivoju vpra≈°anja):
        <div class="small">
          <code class="k">toƒçke = max(0, (pravilno_oznaƒçeno - napaƒçno_oznaƒçeno) / ≈°t_pravilnih)</code>
          <br/>Pri vpra≈°anjih z enim pravilnim odgovorom (radio) in Da/Ne je toƒçka 1 ali 0.
        </div>
      </div>
      <div class="spacer"></div>
      <div class="row">
        <button id="btnStart">Zaƒçni (nakljuƒçno 20)</button>
        <span class="pill" id="bankInfo"></span>
      </div>
    </div>

    <div class="card" id="screenQuiz" style="display:none;">
      <div class="row" style="justify-content: space-between;">
        <span class="pill" id="progressPill"></span>
        <span class="pill" id="typePill"></span>
      </div>
      <div class="qtitle" id="qText"></div>
      <div class="opts" id="options"></div>

      <div class="footer">
        <div class="row">
          <button class="ghost" id="btnPrev">Nazaj</button>
          <button class="ghost" id="btnNext">Naprej</button>
        </div>
        <div class="row">
          <button class="secondary" id="btnReset">Ponastavi (nova 20)</button>
          <button id="btnFinish">Oddaj (preveri)</button>
        </div>
      </div>
    </div>

    <div class="card" id="screenResult" style="display:none;">
      <div class="summary-box">
        <div class="summary-title">Povzetek</div>
        <div class="summary-line" id="scoreLine"></div>
        <div class="badges" id="summaryBadges"></div>
      </div>

      <div class="hr"></div>
      <div class="row">
        <button id="btnStartAgain">Zaƒçni znova (nova 20)</button>
        <button class="secondary" id="btnBackToQuiz">Nazaj na vpra≈°anja</button>
      </div>

      <div class="hr"></div>
      <h1 style="font-size:18px;">Pregled napak</h1>
      <div id="review"></div>
    </div>
  </div>

<script>
/*
  BAZA VPRA≈†ANJ: vkljuƒçuje
  a) vse trditve (Da/Ne) iz tvoje liste
  b) vsa vpra≈°anja 1‚Äì30 iz tvoje liste (radio/checkbox)
*/
const QUESTION_BANK = [
  // ========== a) Naloga (Da/Ne) ==========
  { id:"a1", type:"tf", text:"Varen elektronski podpis skladen z ZEISZ praviloma izdelamo z uporabo simetriƒçne kriptografije.", correct:false },
  { id:"a2", type:"tf", text:"Za zagotavljanje sklepƒçnosti mora biti na seji dr≈æavnega zbora prisotna vsaj tretjina poslancev.", correct:false },
  { id:"a3", type:"tf", text:"IP naslov ni osebni podatek.", correct:false },
  { id:"a4", type:"tf", text:"Evidenca dejavnosti obdelave je obvezna za vse organizacije.", correct:false },
  { id:"a5", type:"tf", text:"Privolitev za obdelavo osebnih podatkov je veljavna tudi, ƒçe je obvezna po pogodbi, ki jo sklepa posameznik.", correct:false },
  { id:"a6", type:"tf", text:"Zakonska, sodna in izvr≈°ilna oblast so tri veje oblasti v RS.", correct:true },
  { id:"a7", type:"tf", text:"Okvir za upravljanje in kontrolo IT je namenjen samo notranjim uporabnikom.", correct:false },
  { id:"a8", type:"tf", text:"Za aplikativne kontrole je v celoti zadol≈æen IT.", correct:false },
  { id:"a9", type:"tf", text:"Izdajatelji kvalificiranih digitalnih potrdil so del infrastrukture zasebnih kljuƒçev.", correct:false },
  { id:"a10", type:"tf", text:"Javno upravo RS sestavljajo sistemi in institucije, ki zagotavljajo oblast.", correct:false },
  { id:"a11", type:"tf", text:"Po eIDAS sta elektronski podpis in napreden elektronski podpis razliƒçna pojma.", correct:true },
  { id:"a12", type:"tf", text:"GDPR se ne uporablja za namene uporabe osebnih podatkov za osebne potrebe.", correct:true },
  { id:"a13", type:"tf", text:"Ustava RS je najvi≈°ji pravni akt v Sloveniji.", correct:true },
  { id:"a14", type:"tf", text:"Dr≈æavni zbor lahko izvoli, imenuje ali razre≈°i ƒçlane raƒçunskega sodi≈°ƒça.", correct:true },
  { id:"a15", type:"tf", text:"IT si v podjetju praviloma zastavi strate≈°ke cilje, ki so usklajeni s strate≈°kimi cilji dru≈æbe.", correct:true },
  { id:"a16", type:"tf", text:"Merilo rezultata postavimo tako za poslovne cilje, kot za cilje IT, cilje procesa in cilje aktivnosti.", correct:true },
  { id:"a17", type:"tf", text:"Dr≈æavni zbor predstavlja vse dr≈æavljane. Predstavnike volimo vsake 4 leta.", correct:true },
  { id:"a18", type:"tf", text:"Pravica do prenosljivosti osebnih podatkov ni splo≈°na pravica in ne velja vedno.", correct:true },
  { id:"a19", type:"tf", text:"Zakonite podlage za obdelavo osebnih podatkov doloƒça 6. ƒçlen GDPR.", correct:true },
  { id:"a20", type:"tf", text:"DPO je kratica za poobla≈°ƒçeno osebo za varstvo podatkov.", correct:true },

  { id:"a21", type:"tf", text:"Po ZEPEP sta elektronski podpis in varen elektronski podpis razliƒçna pojma.", correct:true },
  { id:"a22", type:"tf", text:"Varen elektronski podpis skladen z ZEPEP praviloma izdelamo z uporabo asimetriƒçne kriptografije.", correct:true },
  { id:"a23", type:"tf", text:"Zakone lahko sprejema le dr≈æavni zbor.", correct:true },
  { id:"a24", type:"tf", text:"Dr≈æavni zbor ima veƒç predsednikov.", correct:false },
  { id:"a25", type:"tf", text:"Dr≈æavni zbor volimo vsaka 4 leta.", correct:true },
  { id:"a26", type:"tf", text:"Ministre imenuje predsednik dr≈æave.", correct:false },
  { id:"a27", type:"tf", text:"V Sloveniji so sodi≈°ƒça razdeljena v tri stopnje.", correct:true },
  { id:"a28", type:"tf", text:"Izvr≈°ilna oblast skrbi za izvajanje zakonov.", correct:true },
  { id:"a29", type:"tf", text:"Pravni akti praviloma zaƒçnejo veljati 15. dan po objavi v Uradnem listu RS.", correct:true },

  { id:"a30", type:"tf", text:"Pri opravljanju slu≈æbe za pomoƒç uporabnikom je potrebno bele≈æenje in sledenje klicev strank.", correct:true },
  { id:"a31", type:"tf", text:"V poroƒçilo o dejavnosti slu≈æbe za pomoƒç uporabnikom je potrebno vkljuƒçiti merjenje izvedbe storitev, odzivni ƒças storitev, ugotavljanje trendov in ponavljajoƒçe te≈æave.", correct:true },
  { id:"a32", type:"tf", text:"Obstaja velika mno≈æica nabora orodij, ki so popolnoma skladna s COBIT procesi.", correct:false },
  { id:"a33", type:"tf", text:"Dr≈æavni svet volimo vsaka 4 leta.", correct:false },

  { id:"a34", type:"tf", text:"Zakone objavijo ministrstva na svojih spletnih straneh.", correct:false },
  { id:"a35", type:"tf", text:"V Sloveniji so priznane tri manj≈°ine.", correct:false },
  { id:"a36", type:"tf", text:"V Sloveniji je samo eno okrajno sodi≈°ƒçe.", correct:false },
  { id:"a37", type:"tf", text:"Dr≈æavni svet je skupina poslancev v dr≈æavnem zboru.", correct:false },
  { id:"a38", type:"tf", text:"V Sloveniji imamo ≈°tiri pokrajine.", correct:false },
  { id:"a39", type:"tf", text:"Notarji so odvetniki, ki sestavljajo oporoke.", correct:false },
  { id:"a40", type:"tf", text:"Besedila predpisov je mo≈æno dobiti tudi brezplaƒçno na internetu.", correct:true },
  { id:"a41", type:"tf", text:"Overitelji kvalificiranih digitalnih potrdil so del infrastrukture javnih kljuƒçev.", correct:true },
  { id:"a42", type:"tf", text:"Proces upravljajte slu≈æbo za pomoƒç uporabnikom in obvladujte incidente spada v domeno Naƒçrtujte in organizirajte.", correct:false },
  { id:"a43", type:"tf", text:"Finanƒçni direktor je posvetovan o obsegu plaƒç.", correct:true },
  { id:"a44", type:"tf", text:"Za opredelitev informacijske arhitekture podjetja zadostuje, ƒçe izdelamo ustrezne ER diagrame podatkovnih baz.", correct:false },
  { id:"a45", type:"tf", text:"V procesu PO2 doloƒçamo tudi lastnike podatkov. Lastniki podatkov so vedno zaposleni v informatiki.", correct:false },
  { id:"a46", type:"tf", text:"Vsa podjetja imajo opredeljen strate≈°ki naƒçrt in s tem tudi vizijo ter poslanstvo.", correct:false },
  { id:"a47", type:"tf", text:"Slu≈æba za skladnost, revizijo, presojo, tveganje in varovanje so odgovorne za produkcijo IT.", correct:false },
  { id:"a48", type:"tf", text:"CIO ima v podjetju vi≈°ja pooblastila kot CEO.", correct:false },
  { id:"a49", type:"tf", text:"Cilji podjetja so poslovna skrivnost.", correct:false },
  { id:"a50", type:"tf", text:"Matrika ZOPS podaja natanƒçna navodila za zdru≈æevanje funkcij v manj≈°em podjetju.", correct:false },
  { id:"a51", type:"tf", text:"Za vse aktivnosti, ki se odvijajo v IT sektorju, je odgovoren CFO.", correct:false },
  { id:"a52", type:"tf", text:"Uƒçinkovitost doloƒça ali smo dosegli cilj procesa (npr. ali smo opravili izpit).", correct:false },
  { id:"a53", type:"tf", text:"Funkcija ki je zadol≈æena za izvedbo doloƒçene aktivnosti ne more biti za njo odgovorna in seznanjena hkrati.", correct:false },
  { id:"a54", type:"tf", text:"Zrelostni model je namenjen primerjavi zrelosti informatike v razliƒçnih podjetjih.", correct:true },
  { id:"a55", type:"tf", text:"Kontrolni cilj PO2.3 doloƒça, da moramo opredeliti kritiƒçnost podatkov. Kritiƒçnost neposredno vpliva na toƒçko obnove podatkov (RPO).", correct:true },
  { id:"a56", type:"tf", text:"CIO je odgovoren za opis delovnih mest v IT sektorju.", correct:true },
  { id:"a57", type:"tf", text:"Procesi za zaposlovanje osebja v sektorju IT mora biti skladen s splo≈°nimi kadrovskimi politikami in postopki organizacije. Za izvr≈°itev le tega je odgovoren CIO.", correct:false },
  { id:"a58", type:"tf", text:"Opredeljena informacijska arhitektura ugodno vpliva na razpolo≈æljivost, skladnost in zanesljivost informacijskega sistema.", correct:true },
  { id:"a59", type:"tf", text:"S poroƒçilom, ki nastane pri procesu DS8 so seznanjeni: CEO, CIO, lastnik poslovnega procesa, vodja produkcije, vodja administracije IT ter skladnost, revizija, tveganja in varnost.", correct:true },
  { id:"a60", type:"tf", text:"ƒåe izdelamo strate≈°ki naƒçrt IT to vpliva na uƒçinkovitost in uspe≈°nost.", correct:true },
  { id:"a61", type:"tf", text:"Proces Upravljajte ƒçlove≈°ke vire v sektorju IT je uvr≈°ƒçen v domeno Naƒçrtujte in organizirajte.", correct:true },
  { id:"a62", type:"tf", text:"V strate≈°kem naƒçrtu IT so zapisani natanƒçni roki za izvedbo projektov vkljuƒçno s projektnim naƒçrtom, stro≈°ki in drugimi viri, ki bodo potrebni za izvedbo.", correct:false },
  { id:"a63", type:"tf", text:"Slu≈æba za pomoƒç strankam je zadol≈æena, da stranke obvesti o posodobitvah statusa njihovega incidenta.", correct:true },
  { id:"a64", type:"tf", text:"Vsaka dru≈æba mora imeti strate≈°ki naƒçrt za IT.", correct:false },
  { id:"a65", type:"tf", text:"Cilji IT morajo izhajati iz strate≈°kih ciljev organizacije.", correct:true },
  { id:"a66", type:"tf", text:"Podjetje mora imeti jasno izbrano ciljno skupino svojih potencialnih strank/naroƒçnikov.", correct:true },
  { id:"a67", type:"tf", text:"V matriki ZOPS so natanƒçno opredeljene aktivnosti vseh zaposlenih v IT sektorju.", correct:false },
  { id:"a68", type:"tf", text:"Matrika ZOPS doloƒça podrobne naloge posameznih udele≈æencev v procesu.", correct:false },
  { id:"a69", type:"tf", text:"Stanje procesa merimo z metrikami.", correct:true },
  { id:"a70", type:"tf", text:"Ljudje so po COBIT eden od virov delovanja IT.", correct:true },
  { id:"a71", type:"tf", text:"V korporacijskem slovarju podatkov doloƒçimo kdo je lastnik katerih podatkov.", correct:false },
  { id:"a72", type:"tf", text:"Vsak proces je oznaƒçen z dvoƒçrkovno oznako in ≈°tevilko.", correct:true },
  { id:"a73", type:"tf", text:"Zanesljivost je eden od informacijskih kriterijev po COBIT.", correct:true },
  { id:"a74", type:"tf", text:"Loƒçevanje nalog je ena od kljuƒçnih nalog v IT.", correct:true },
  { id:"a75", type:"tf", text:"Vizija, poslanstvo in cilji podjetja so del strate≈°ke domene podjetja.", correct:true },
  { id:"a76", type:"tf", text:"Vsak proces je opisan tudi z matriko, iz katere je razvidno kateri procesi potrebujejo izdelke posameznega procesa.", correct:true },
  { id:"a77", type:"tf", text:"Skladnost doloƒça ali informacijski sistem deluje tako, kot doloƒçajo predpisi in standardi.", correct:true },
  { id:"a78", type:"tf", text:"Kontrole so namenjene temu, da zbirajo podatke o delovanju procesov.", correct:false },
  { id:"a79", type:"tf", text:"Loƒçimo aplikacijske in splo≈°ne kontrole.", correct:true },

  // ========== b) Naloga (1‚Äì30) ==========
  {
    id:"b1", type:"multi",
    text:"1. Sredstvo za varno elektronsko podpisovanje mora zagotavljati:",
    options:["Asimetriƒçni ≈°ifrirni kljuƒç","Jasno oznaƒçen psevdonim","Zanesljivo varovanje pred nepoobla≈°ƒçenim dostopom","Edinstvenost podatkov za elektronsko podpisovanje"],
    correct:[2,3]
  },
  {
    id:"b2", type:"single",
    text:"2. Vi≈°ja sodi≈°ƒça v RS:",
    options:["So le v Ljubljani","So v Ljubljani in Mariboru","Skrbijo za sodno prakso","So predvsem prito≈æbena sodi≈°ƒça"],
    correct:3
  },
  {
    id:"b3", type:"multi",
    text:"3. Vrhovno sodi≈°ƒçe RS:",
    options:["Je le v Ljubljani","Je v Ljubljani in Mariboru","Skrbi za enotno sodno prakso","Je namenjeno sojenju najhuj≈°im zloƒçincem"],
    correct:[0,2]
  },
  {
    id:"b4", type:"multi",
    text:"4. Ustavno sodi≈°ƒçe:",
    options:["Sestavlja 6 ustavnih sodnikov","Mandat ustavnih sodnikov je 6 let","Je namenjeno nadzoru zakonodajalca","Ustavni sodniki so ƒçlani ministrstva","Sestavlja 9 ustavnih sodnikov","Mandat ustavnih sodnikov je 9 let"],
    correct:[2,4,5]
  },
  {
    id:"b5", type:"single",
    text:"5. Katere niso veja oblasti v Republiki Sloveniji?",
    options:["Zakonodajna oblast","Sodna oblast","Izvr≈°ilna oblast","Davƒçna oblast"],
    correct:3
  },
  {
    id:"b6", type:"single",
    text:"6. Ombudsman je drugo ime za‚Ä¶",
    options:["Varuha ƒçlovekovih pravic"],
    correct:0
  },
  {
    id:"b7", type:"single",
    text:"7. Neoblastne pravne akte izdajajo:",
    options:["Ministrstva","Obƒçine","Vlada","Dru≈°tva"],
    correct:3
  },
  {
    id:"b8", type:"multi",
    text:"8. Kdo lahko predlaga zakone v RS?",
    options:["Poslanci","Dr≈æavni svet","Vlada","Minister in 5000 volivcev"],
    correct:[0,1,2]
  },
  {
    id:"b9", type:"single",
    text:"9. S katero angle≈°ko kratico oznaƒçimo pogodbo s katero opredelimo ravni storitev?",
    options:["SLA"],
    correct:0
  },
  {
    id:"b10", type:"multi",
    text:"10. Katere so osnovne komponente PKI:",
    options:["DIR","CA"],
    correct:[0,1]
  },
  {
    id:"b11", type:"multi",
    text:"11. Na kaj se po COBIT osredotoƒçajo procesi v domeni Naƒçrtujte in organizirajte?",
    options:["Zagotavljanje kibernetske varnosti","Razumevanje in upravljanje tveganj IT","Uskladitev poslovne in IT strategije","Doloƒçitev tehnolo≈°ke usmeritve"],
    correct:[1,2,3]
  },
  {
    id:"b12", type:"multi",
    text:"12. Katera od naslednjih so sredstva za komuniciranje na daljavo?",
    options:["Pisemske po≈°iljke","Telefonski pogovori","Katalogi","Televizijska prodaja"],
    correct:[0,1,2,3]
  },
  {
    id:"b13", type:"single",
    text:"13. Kaj se doloƒça z Zakonom o varstvu osebnih podatkov?",
    options:["Doloƒçajo se pravice, obveznosti, naƒçela in ukrepi, s katerimi se prepreƒçujejo neustavni, nezakoniti in neupraviƒçeni posegi v zasebnost in dostojnost posameznika."],
    correct:0
  },
  {
    id:"b14", type:"multi",
    text:"14. Katera so osnovna naƒçela glede neposrednega tr≈æenja oz. po≈°iljanja komercialnih sporoƒçil?",
    options:["Upo≈°tevanje Zakona o varstvu osebnih podatkov in GDPR","Nedvoumno jasno je navedena fiziƒçna ali pravna oseba, v imenu katere je bilo komercialno sporoƒçilo poslano","Ko naslovnik enkrat sprejme nadaljnjo uporabo, tega ne more veƒç preklicati","Potrebno je soglasje naslovnika"],
    correct:[0,1,3]
  },
  {
    id:"b15", type:"single",
    text:"15. IT je v produkcijo pravoƒçasno predal programsko opremo in za izdelavo porabil predvidena sredstva, vendar re≈°itev ne deluje skladno z zahtevami uporabnikov. Kateri IT kriterij po COBIT ni bil dose≈æen?",
    options:["Uspe≈°nost"],
    correct:0
  },
  {
    id:"b16", type:"multi",
    text:"16. Kateri zakon/i urejajo podroƒçje neza≈æelene elektronske po≈°te SPAM?",
    options:["Zakon o varstvu osebnih podatkov","Zakon o varstvu elektronske po≈°te","Zakon o elektronskem poslovanju na trgu","Zakon o elektronskih komunikacijah"],
    correct:[2,3]
  },
  {
    id:"b17", type:"single",
    text:"17. Ali je za zaƒçetek opravljanja in izvajanje dejavnosti storitev informacijske dru≈æbe treba pridobiti predhodno dovoljenje?",
    options:["Ne"],
    correct:0
  },
  {
    id:"b18", type:"multi",
    text:"18. Prodaja v elektronski trgovini pomeni tudi sklenitev pogodbe. Kateri zakon ureja to vrsto pogodbe",
    options:["Zakon o varstvu potro≈°nikov","Zakon o pogodbenih odnosih","Zakon o elektronskem poslovovanju na trgu","Zakon o elektronskih komunikacijah"],
    correct:[0,2]
  },
  {
    id:"b19", type:"multi",
    text:"19. Katere zahteve mora izpolnjevati varen elektronski podpis?",
    options:["Iz njega je mogoƒçe zanesljivo ugotoviti podpisnika","Z njim je mogoƒçe identificirati podpisnika","Enoliƒçno povezan s podpisnikom","Povezan mora biti izkljuƒçno s podpisnikom"],
    correct:[0,2,3]
  },
  {
    id:"b20", type:"single",
    text:"20. Kdaj se lahko obdelujejo osebni podatki v javnem sektorju?",
    options:["Kadar tako odloƒçi sodi≈°ƒçe","Samo ob zakljuƒçku vsakega fiskalnega leta","Kadar tako zahteva policija","Kadar to doloƒça zakon"],
    correct:3
  },
  {
    id:"b21", type:"multi",
    text:"21. Dostop do katerih podatkov mora zagotoviti ponudnik storitev informacijske dru≈æbe prejemnikom storitev?",
    options:["Davƒçno ≈°tevilko","Veljaven elektronski naslov za hitro in uƒçinkovito komuniciranje","Podatke o podjetju in sede≈æu ponudnika storitev","EM≈†O"],
    correct:[1,2]
  },
  {
    id:"b22", type:"multi",
    text:"22. Zakon o elektronskih komunikacijah doloƒça:",
    options:["Pravila uporabe pi≈°kotkov na spletnih straneh","Ne≈æeleno komunikacijo (SPAM)","Obvezno vsebino pi≈°kotkov","Pravila sklepanja pogodb v elektronski obliki"],
    correct:[0,1]
  },
  {
    id:"b23", type:"multi",
    text:"23. Komu je vse namenjen kontrolni okvir COBIT?",
    options:["Direktorjem","Poslovnemu vodstvu","Vodstvu IT","Revizorjem in presojevalcem"],
    correct:[0,1,2,3]
  },
  {
    id:"b24", type:"multi",
    text:"24. Pravni akti veljajo:",
    options:["Vedno za naprej (prihodnost)","Vedno za nazaj (preteklost)","Do njihove razveljavitve","Do njihove objave v uradnem listu RS"],
    correct:[0,2]
  },
  {
    id:"b25", type:"single",
    text:"25. Kako se imenuje evidenca, v kateri so podatki iz katalogov zbirk osebnih podatkov",
    options:["Katalog zbirke osebnih podatkov","Register zbirk osebnih podatkov","Pravilnik o varovanju osebnih podatkov","Seznam zbirk osebnih podatkov"],
    correct:1
  },
  {
    id:"b26", type:"multi",
    text:"26. Na kaj se osredotoƒçajo procesi v domeni ¬ªNaƒçrtujte in organizirajte¬´?",
    options:["Uskladitev poslovne in IT strategije","Razumevanje in upravljanje tveganj IT","Optimizacijo stro≈°kov","Merjenje delovanja IT"],
    correct:[0,1]
  },
  {
    id:"b27", type:"single",
    text:"27. Zakon o varstvu osebnih podatkov ureja podroƒçje:",
    options:["Prodaje osebnih podatkov","Tiskanje osebnih podatkov","Obdelave osebnih podatkov","Hrambe dokumentarnega gradiva z osebnimi podatki"],
    correct:2
  },
  {
    id:"b28", type:"multi",
    text:"28. Ponudnik storitve lahko po≈°ilja komercialna sporoƒçila, ki so del storitev informacijske dru≈æbe, ƒçe:",
    options:[
      "Prejemnik storitve vnaprej sogla≈°a s po≈°iljanjem,",
      "Je komercialno sporoƒçilo kot tako jasno razpoznavno,",
      "Je nedvoumno navedena fiziƒçna ali pravna oseba, v imenu katere je komercialno sporoƒçilo poslano,",
      "So jasno in nedvoumno navedeni pogoji za sprejem posebnih ponudb, ki so povezane s popusti, premijami in darili, ki morajo biti kot taki nedvoumno oznaƒçeni."
    ],
    correct:[0,1,2,3]
  },
  {
    id:"b29", type:"single",
    text:"29. Kaj se doloƒça z Zakonom o varstvu osebnih podatkov?",
    options:["A) ‚Ä¶ nezakoniti in neupraviƒçeni posegi ‚Ä¶"],
    correct:0
  },
  {
    id:"b30", type:"multi",
    text:"30. Katera so osnovna naƒçela glede neposrednega tr≈æenja oz. po≈°iljanja komercialnih sporoƒçil?",
    options:["Nedvoumno jasno je navedena fiziƒçna ali pravna oseba, v imenu katere je bilo komercialno sporoƒçilo poslano","Potrebno je soglasje naslovnika"],
    correct:[0,1]
  }
];

const PICK_COUNT = 20;

const state = {
  picked: [],
  answers: new Map(),
  idx: 0,
  submitted: false,
  lastResult: null
};

const el = (id) => document.getElementById(id);

function shuffle(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function pickRandomQuestions() {
  const bank = QUESTION_BANK.slice();
  if (bank.length < PICK_COUNT) {
    alert("Baza vpra≈°anj je manj≈°a od 20. Dodaj veƒç vpra≈°anj v QUESTION_BANK.");
    return shuffle(bank);
  }
  return shuffle(bank).slice(0, PICK_COUNT);
}

function resetQuiz() {
  state.picked = pickRandomQuestions();
  state.answers = new Map();
  state.idx = 0;
  state.submitted = false;
  state.lastResult = null;
  showScreen("quiz");
  renderQuestion();
}

function showScreen(which) {
  el("screenStart").style.display = (which === "start") ? "block" : "none";
  el("screenQuiz").style.display  = (which === "quiz")  ? "block" : "none";
  el("screenResult").style.display= (which === "result")? "block" : "none";
}

function qTypeLabel(q) {
  if (q.type === "tf") return "Da/Ne";
  if (q.type === "single") return "Ena izbira";
  if (q.type === "multi") return "Veƒç izbir (checkbox)";
  return q.type;
}

function ensureDefaultAnswer(q) {
  if (state.answers.has(q.id)) return;
  if (q.type === "tf") state.answers.set(q.id, null);
  else if (q.type === "single") state.answers.set(q.id, null);
  else if (q.type === "multi") state.answers.set(q.id, new Set());
}

function renderQuestion() {
  const q = state.picked[state.idx];
  ensureDefaultAnswer(q);

  el("progressPill").textContent = `Vpra≈°anje ${state.idx + 1} / ${state.picked.length}`;
  el("typePill").textContent = qTypeLabel(q);
  el("qText").textContent = q.text;

  const opts = el("options");
  opts.innerHTML = "";

  if (q.type === "tf") {
    const options = ["Da", "Ne"];
    options.forEach((label, i) => {
      const val = (i === 0);
      const current = state.answers.get(q.id);
      const checked = (current === val);

      const id = `opt_${q.id}_${i}`;
      const lab = document.createElement("label");
      lab.className = "opt";
      lab.setAttribute("for", id);

      const input = document.createElement("input");
      input.type = "radio";
      input.name = `q_${q.id}`;
      input.id = id;
      input.checked = checked;
      input.addEventListener("change", () => state.answers.set(q.id, val));

      const span = document.createElement("span");
      span.textContent = label;

      lab.appendChild(input);
      lab.appendChild(span);
      opts.appendChild(lab);
    });
  } else if (q.type === "single") {
    q.options.forEach((text, i) => {
      const current = state.answers.get(q.id);
      const id = `opt_${q.id}_${i}`;
      const lab = document.createElement("label");
      lab.className = "opt";
      lab.setAttribute("for", id);

      const input = document.createElement("input");
      input.type = "radio";
      input.name = `q_${q.id}`;
      input.id = id;
      input.checked = (current === i);
      input.addEventListener("change", () => state.answers.set(q.id, i));

      const span = document.createElement("span");
      span.textContent = text;

      lab.appendChild(input);
      lab.appendChild(span);
      opts.appendChild(lab);
    });
  } else if (q.type === "multi") {
    q.options.forEach((text, i) => {
      const set = state.answers.get(q.id);
      const checked = set.has(i);
      const id = `opt_${q.id}_${i}`;

      const lab = document.createElement("label");
      lab.className = "opt";
      lab.setAttribute("for", id);

      const input = document.createElement("input");
      input.type = "checkbox";
      input.id = id;
      input.checked = checked;
      input.addEventListener("change", () => {
        const s = state.answers.get(q.id);
        if (input.checked) s.add(i);
        else s.delete(i);
      });

      const span = document.createElement("span");
      span.textContent = text;

      lab.appendChild(input);
      lab.appendChild(span);
      opts.appendChild(lab);
    });
  }

  el("btnPrev").disabled = (state.idx === 0);
  el("btnNext").disabled = (state.idx === state.picked.length - 1);
}

function calcQuestionScore(q) {
  const ans = state.answers.get(q.id);

  if (q.type === "tf") {
    if (ans === null) return { score: 0, max: 1, detail: { answered:false } };
    const ok = (ans === q.correct);
    return { score: ok ? 1 : 0, max: 1, detail: { ok, answered:true } };
  }

  if (q.type === "single") {
    if (ans === null) return { score: 0, max: 1, detail: { answered:false } };
    const ok = (ans === q.correct);
    return { score: ok ? 1 : 0, max: 1, detail: { ok, answered:true } };
  }

  if (q.type === "multi") {
    const correctSet = new Set(q.correct);
    const selected = ans;
    const numCorrect = correctSet.size;

    let correctSelected = 0;
    let wrongSelected = 0;

    for (const i of selected) {
      if (correctSet.has(i)) correctSelected++;
      else wrongSelected++;
    }

    let raw = (correctSelected - wrongSelected) / (numCorrect || 1);
    if (raw < 0) raw = 0;
    if (raw > 1) raw = 1;

    return {
      score: raw,
      max: 1,
      detail: { correctSelected, wrongSelected, numCorrect, answered: selected.size > 0 }
    };
  }

  return { score: 0, max: 1, detail: { answered:false } };
}

function submitQuiz() {
  const perQ = state.picked.map(q => {
    const r = calcQuestionScore(q);
    return { q, ...r };
  });

  const total = perQ.reduce((s,x)=>s + x.score, 0);
  const max = perQ.reduce((s,x)=>s + x.max, 0);
  const pct = max > 0 ? (total / max) * 100 : 0;

  state.submitted = true;
  state.lastResult = { perQ, total, max, pct };

  renderResult();
  showScreen("result");
}

/* ---------- helpers for detailed correctness display ---------- */
function getUserAnswerIndices(q) {
  const ans = state.answers.get(q.id);
  if (q.type === "multi") return Array.from(ans || []).sort((a,b)=>a-b);
  if (q.type === "single") return (ans === null ? [] : [ans]);
  if (q.type === "tf") {
    if (ans === null) return [];
    // map Da/Ne to indices 0/1
    return [ans ? 0 : 1];
  }
  return [];
}

function getCorrectAnswerIndices(q) {
  if (q.type === "multi") return q.correct.slice().sort((a,b)=>a-b);
  if (q.type === "single") return [q.correct];
  if (q.type === "tf") return [q.correct ? 0 : 1];
  return [];
}

function getOptionLabel(q, idx) {
  if (q.type === "tf") return (idx === 0) ? "Da" : "Ne";
  return q.options[idx];
}

function renderOptionDiffList(q) {
  // For multi: show each option with marker (‚úì correct chosen, ‚úó wrong chosen, ! missing correct)
  // For single/tf: show chosen and correct lines + markers
  const userIdx = new Set(getUserAnswerIndices(q));
  const corrIdx = new Set(getCorrectAnswerIndices(q));

  if (q.type === "multi") {
    const items = [];
    for (let i=0; i<q.options.length; i++) {
      const chosen = userIdx.has(i);
      const correct = corrIdx.has(i);

      if (chosen && correct) items.push(`<li><span class="mark-ok">‚úì</span> ${escapeHtml(q.options[i])}</li>`);
      else if (chosen && !correct) items.push(`<li><span class="mark-bad">‚úó</span> ${escapeHtml(q.options[i])}</li>`);
      else if (!chosen && correct) items.push(`<li><span class="mark-miss">!</span> ${escapeHtml(q.options[i])}</li>`);
      else items.push(`<li>${escapeHtml(q.options[i])}</li>`);
    }
    return `<ul class="optlist">${items.join("")}</ul>`;
  }

  // single or tf:
  const user = getUserAnswerIndices(q);
  const corr = getCorrectAnswerIndices(q);

  const userText = user.length ? escapeHtml(getOptionLabel(q, user[0])) : "Brez odgovora";
  const corrText = escapeHtml(getOptionLabel(q, corr[0]));

  const ok = (user.length && user[0] === corr[0]);

  return `
    <div class="chips">
      <span class="chip ${ok ? "ok" : "bad"}">${ok ? "‚úì" : "‚úó"} Tvoj odgovor: ${userText}</span>
      <span class="chip ok">‚úì Pravilno: ${corrText}</span>
    </div>
  `;
}

function escapeHtml(str) {
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function renderResult() {
  const r = state.lastResult;

  // --- score line ---
  const totalRounded = Math.round(r.total * 100) / 100;
  const pctRounded = Math.round(r.pct * 10) / 10;
  el("scoreLine").textContent = `Rezultat: ${totalRounded} / ${r.max} (${pctRounded}%)`;

  // --- aggregate counts (checkbox-style counts; same as before) ---
  let correctChosen = 0;
  let wrongChosen = 0;
  let missingCorrect = 0;

  let questionsWithLoss = 0;
  r.perQ.forEach((x) => {
    if (x.score < 1) questionsWithLoss++;

    const q = x.q;
    if (q.type !== "multi") return;

    const selected = state.answers.get(q.id) || new Set();
    const correctSet = new Set(q.correct);

    for (const i of selected) {
      if (correctSet.has(i)) correctChosen++;
      else wrongChosen++;
    }
    for (const i of correctSet) {
      if (!selected.has(i)) missingCorrect++;
    }
  });

  // --- badges ---
  const badges = el("summaryBadges");
  badges.innerHTML = "";

  const badge = (cls, icon, label, value) => {
    const div = document.createElement("div");
    div.className = `badge ${cls}`;
    div.innerHTML = `<span class="dot">${icon}</span> <span>${label}: <b>${value}</b></span>`;
    return div;
  };

  badges.appendChild(badge("ok", "‚úÖ", "pravilno izbranih", correctChosen));
  badges.appendChild(badge("bad", "‚ùå", "napaƒçno izbranih", wrongChosen));
  badges.appendChild(badge("warn", "‚ö†Ô∏è", "manjkajoƒçih pravilnih", missingCorrect));
  badges.appendChild(badge("neutral", "üìù", "Vpra≈°anja z izgubo toƒçk", questionsWithLoss));

  // --- errors list with details (what was right/wrong) ---
  const review = el("review");
  review.innerHTML = "";

  const wrong = r.perQ
    .map((x, idx) => ({...x, idx}))
    .filter(x => x.score < x.max);

  if (wrong.length === 0) {
    const div = document.createElement("div");
    div.className = "error-row";
    div.innerHTML = `<div class="error-left"><b>Brez napak.</b></div><div class="error-score">1.00/1.00</div>`;
    review.appendChild(div);
    return;
  }

  wrong.forEach((x) => {
    const q = x.q;
    const div = document.createElement("div");
    div.className = "error-row";
    div.style.flexDirection = "column";
    div.style.alignItems = "stretch";

    const scoreStr = `${(Math.round(x.score * 100) / 100).toFixed(2)}/1.00`;
    const leftText = `#${x.idx + 1} ${q.text}`;

    // header row (text + score)
    const header = document.createElement("div");
    header.className = "row";
    header.style.justifyContent = "space-between";
    header.innerHTML = `
      <div class="error-left"><b>${escapeHtml(leftText)}</b></div>
      <div class="error-score">${scoreStr}</div>
    `;

    // details
    const details = document.createElement("div");
    details.className = "error-details";

    // Legend chips for multi
    let legend = "";
    if (q.type === "multi") {
      legend = `
        <div class="chips">
          <span class="chip ok">‚úì pravilno oznaƒçeno</span>
          <span class="chip bad">‚úó napaƒçno oznaƒçeno</span>
          <span class="chip miss">! manjkajoƒçe pravilno</span>
        </div>
      `;
    }

    details.innerHTML = `
      ${legend}
      <div class="detail-line">${renderOptionDiffList(q)}</div>
    `;

    div.appendChild(header);
    div.appendChild(details);
    review.appendChild(div);
  });
}

function goPrev() { if (state.idx > 0) { state.idx--; renderQuestion(); } }
function goNext() { if (state.idx < state.picked.length - 1) { state.idx++; renderQuestion(); } }

el("btnStart").addEventListener("click", resetQuiz);
el("btnPrev").addEventListener("click", goPrev);
el("btnNext").addEventListener("click", goNext);
el("btnFinish").addEventListener("click", submitQuiz);
el("btnReset").addEventListener("click", resetQuiz);
el("btnStartAgain").addEventListener("click", resetQuiz);
el("btnBackToQuiz").addEventListener("click", () => showScreen("quiz"));

el("bankInfo").textContent = `Baza: ${QUESTION_BANK.length} vpra≈°anj. Vsak zagon izbere 20.`;
showScreen("start");
</script>
</body>
</html>
